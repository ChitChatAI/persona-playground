<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Persona Playground | ChitChat AI</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Icons + Fonts -->
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js" crossorigin="anonymous"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js" crossorigin="anonymous"></script>
  <link href="https://api.fontshare.com/v2/css?f[]=satoshi@400,500,700&display=swap" rel="stylesheet">

  <!-- Highlight.js (optional) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css" id="hljs-light-theme" />
  <link rel="stylesheet" disabled id="hljs-dark-theme" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css" />

  <!-- App CSS -->
  <link rel="stylesheet" href="/static/css/styles.css" />

  <style>
    .fixed-input-area {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      z-index: 1050;
      background: #f8f9fa;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.04);
      transition: height .2s, padding .2s;
    }
    .fixed-input-area.shrink { padding-top: 4px !important; padding-bottom: 4px !important; }
    .fixed-input-area .input-container textarea {
      transition: min-height .2s, height .2s;
      min-height: 38px; max-height: 120px; resize: vertical;
    }
    .fixed-input-area.shrink .input-container textarea { min-height: 28px; max-height: 60px; }
    .main-content { padding-bottom: 110px; }
    .chat-header { position: sticky; top: 0; z-index: 2; background: #fff; border-bottom: 1px solid #eee; }
  </style>
</head>

<body>
  <div class="app-container">
    <div class="main-content container-fluid">
      <div class="row">
        <!-- Left: Persona Panel -->
        <div class="col-md-6 border-end" style="min-height: 100vh;">
          <div class="chat-container">
            <div class="chat-header d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center gap-3">
                <h5 class="mb-0" id="personaTitle">Persona</h5>
                <span class="text-muted" id="personaPanelLabel">
                  <span class="offline-badge" id="offlineBadge">Offline</span>
                </span>
                <div class="tone-indicator ms-2" id="toneIndicator">
                  <ion-icon name="happy-outline"></ion-icon>
                  <span id="toneText">Neutral</span>
                </div>
              </div>

              <div class="d-flex align-items-center gap-2">
                <button class="btn btn-sm btn-outline-secondary" id="clearLeftBtn" title="Clear conversation">Clear</button>
                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#uploadPersonaModal" title="Upload Persona Files">Upload</button>
              </div>
            </div>

            <div class="messages" id="messages"></div>
            <div class="loading-indicator" id="loadingIndicator">
              <div class="loading-spinner"></div>
              <span>Processing your request...</span>
            </div>
          </div>
        </div>

        <!-- Right: Vanilla GPT Panel -->
        <div class="col-md-6" style="min-height: 100vh;">
          <div class="chat-container">
            <div class="chat-header d-flex justify-content-between align-items-center">
              <div>
                <h5 class="mb-0">Vanilla GPT <span class="offline-badge" id="offlineBadgeVanilla">Offline</span></h5>
              </div>
              <div class="tone-indicator" id="toneIndicatorVanilla">
                <ion-icon name="happy-outline"></ion-icon>
                <span id="toneTextVanilla">Neutral</span>
              </div>
            </div>
            <div class="messages" id="messagesVanilla"></div>
            <div class="loading-indicator" id="loadingIndicatorVanilla">
              <div class="loading-spinner"></div>
              <span>Processing your request...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Fixed input area -->
    <div class="fixed-input-area border-top pt-2 pb-2">
      <div class="container">
        <div class="suggestion-container mb-2">
          <div class="suggestion-chips" id="suggestionChips">
            <button class="suggestion-chip">It feels like we've know each other for years!</button>
            <button class="suggestion-chip">Can we have a relaxed chat?</button>
            <button class="suggestion-chip">I'm in a weird mood â€“ can we talk?</button>
            <button class="suggestion-chip">Samantha, convince me to stay with rain.</button>
            <button class="suggestion-chip">How would you handle a really difficult customer?</button>
            <button class="suggestion-chip">Can you help me humanise this chatbot reply?</button>
            <button class="suggestion-chip">Take this cold message and make it warmer.</button>
            <button class="suggestion-chip">Talk to me like you're in a rush.</button>
            <button class="suggestion-chip">How have you been lately?</button>
            <button class="suggestion-chip">What's your moral stance on white lies in sales?</button>
            <button class="suggestion-chip">Tell me something about yourself.</button>
            <button class="suggestion-chip">Tell me how you make decisions?</button>
          </div>
        </div>

        <div class="input-container d-flex align-items-center">
          <textarea class="form-control me-2" id="messageInput" rows="1" placeholder="Type your message..." required></textarea>
          <div class="input-actions d-flex align-items-center">
            <button class="input-action-button me-1" id="voiceInputBtn" title="Voice input">
              <ion-icon name="mic-outline"></ion-icon>
            </button>
            <button class="input-action-button me-1" id="imageUploadBtn" title="Upload image">
              <ion-icon name="image-outline"></ion-icon>
            </button>
            <input type="file" id="imageInput" accept="image/*" style="display:none" />
          </div>
          <button type="submit" class="send-button ms-2" id="sendBtn">
            <ion-icon name="send-outline"></ion-icon>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Upload Persona Modal -->
  <div class="modal fade" id="uploadPersonaModal" tabindex="-1" aria-labelledby="uploadPersonaLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form class="modal-content" id="uploadPersonaForm">
        <div class="modal-header">
          <h5 class="modal-title" id="uploadPersonaLabel">Upload Persona Files</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Persona name (e.g., samantha, arin, nova)</label>
            <input class="form-control" name="persona_name" id="personaNameInput" placeholder="samantha" required />
          </div>
          <div class="mb-2">
            <input class="form-control" type="file" name="files" id="personaFilesInput" multiple accept=".txt,.md" required />
            <div class="form-text">Allowed: .txt, .md (e.g. <code>natural_behavior_prompt.txt</code>)</div>
          </div>
          <div id="uploadStatus" class="small text-muted"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-primary" type="submit">Upload</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js" defer></script>


  <!-- Cache-bust + defer so the new JS surely loads after DOM -->
  <script src="/static/js/scripts.js?v=4" defer></script>
</body>
</html>
